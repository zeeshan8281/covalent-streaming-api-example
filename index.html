<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Coin Velocity Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'Roboto Mono', monospace; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .new-item { animation: fadeIn 0.5s ease-out forwards; }
        .whale-alert { border-left: 4px solid #f59e0b; } /* amber-500 */
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div class="container mx-auto p-4 lg:p-8">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-white">Meme Coin Velocity Dashboard</h1>
            <p class="text-gray-400 mt-2">Real-time intelligence for high-volume tokens.</p>
        </div>

        <!-- Configuration -->
        <div class="bg-gray-800 rounded-lg p-6 mb-6 shadow-lg flex flex-col md:flex-row items-end justify-between gap-4">
            <div class="w-full">
                <label for="tokenAddress" class="block text-sm font-medium text-gray-400 mb-1">Token Address</label>
                <input type="text" id="tokenAddress" value="0x95aD61b0a150d79219dCF64E1E6Cc01f0B64C4cE" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white font-mono text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
            </div>
            <div class="w-full">
                <label for="pairAddress" class="block text-sm font-medium text-gray-400 mb-1">Uniswap V2 Pair Address</label>
                <input type="text" id="pairAddress" value="0x8116a08973650a6992909581027856E792425952" class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white font-mono text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
            </div>
            <div class="flex-shrink-0">
                <button id="connectButton" class="w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                    Track Token
                </button>
            </div>
        </div>
        
        <!-- Status -->
        <div id="statusIndicator" class="flex items-center justify-center gap-2 text-gray-400 mb-6">
            <div id="statusDot" class="w-3 h-3 rounded-full bg-gray-500"></div>
            <span id="statusText">Disconnected</span>
        </div>

        <!-- Token Information -->
        <div id="tokenInfo" class="bg-gradient-to-r from-indigo-800 to-purple-800 rounded-lg p-6 mb-6 shadow-lg hidden">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <img id="tokenLogo" src="" alt="Token Logo" class="w-12 h-12 rounded-full hidden">
                    <div>
                        <h2 id="tokenName" class="text-2xl font-bold text-white">Loading...</h2>
                        <p id="tokenTicker" class="text-lg text-indigo-200 font-semibold">$LOADING</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-indigo-200 text-sm">Contract Address</p>
                    <p id="displayTokenAddress" class="text-white font-mono text-sm">...</p>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Live Feed -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Transaction Feed -->
                <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                    <h2 class="text-xl font-bold text-white mb-4">Live Transaction Feed</h2>
                    <div id="feed" class="h-[500px] overflow-y-auto pr-2 space-y-3">
                        <p class="text-center text-gray-500 pt-10">Waiting for transactions...</p>
                    </div>
                </div>
            </div>

            <!-- Right Column: Alerts & Stats -->
            <div class="space-y-6">
                <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                    <h2 class="text-xl font-bold text-white mb-4">Whale Watcher</h2>
                    <div id="whale-feed" class="h-[670px] overflow-y-auto pr-2 space-y-3">
                        <p class="text-center text-gray-500 pt-10">Waiting for whale activity...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const tokenAddressInput = document.getElementById('tokenAddress');
        const pairAddressInput = document.getElementById('pairAddress');
        const connectButton = document.getElementById('connectButton');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const feed = document.getElementById('feed');
        const whaleFeed = document.getElementById('whale-feed');

        let backendSocket;

        // --- Event Listeners ---
        connectButton.addEventListener('click', () => {
            if (backendSocket && backendSocket.readyState === WebSocket.OPEN) {
                backendSocket.close();
            } else {
                connectStream();
            }
        });

        // --- Functions ---
        function updateStatus(text, color, isConnected) {
            statusText.textContent = text;
            statusDot.className = `w-3 h-3 rounded-full ${color}`;
            connectButton.textContent = isConnected ? "Disconnect" : "Track Token";
        }

        function connectStream() {
            const tokenAddress = tokenAddressInput.value.trim();
            const pairAddress = pairAddressInput.value.trim();
            if (!tokenAddress || !pairAddress) {
                alert("Please provide both Token and Pair addresses.");
                return;
            }

            updateStatus("Connecting...", "bg-yellow-500", false);
            
            // Connect to Railway backend WebSocket
            const wsUrl = 'wss://meme-dashboard-production-d179.up.railway.app';
            
            backendSocket = new WebSocket(wsUrl);

            backendSocket.onopen = () => {
                updateStatus("Live", "bg-green-500", true);
                // Clear old data
                feed.innerHTML = '<p class="text-center text-gray-500 pt-10">Waiting for transactions...</p>';
                whaleFeed.innerHTML = '<p class="text-center text-gray-500 pt-10">Waiting for whale activity...</p>';

                backendSocket.send(JSON.stringify({
                    type: 'SUBSCRIBE', tokenAddress, pairAddress
                }));
            };

            backendSocket.onmessage = (event) => {
                const message = JSON.parse(event.data);
                switch (message.type) {
                    case 'NEW_TRANSFER':
                        addTransactionToFeed(message.payload);
                        if (message.payload.isWhale) {
                            addWhaleAlert(message.payload);
                        }
                        break;
                    case 'TOKEN_INFO':
                        updateTokenInfo(message.payload);
                        break;
                }
            };

            backendSocket.onerror = (error) => {
                console.error("WebSocket Error:", error);
                updateStatus("Error", "bg-red-500", false);
            };

            backendSocket.onclose = () => {
                updateStatus("Disconnected", "bg-gray-500", false);
            };
        }

        function formatValue(value) {
            if (value > 1_000_000) return `${(value / 1_000_000).toFixed(2)}M`;
            if (value > 1_000) return `${(value / 1_000).toFixed(2)}K`;
            return value.toFixed(2);
        }
        
        function addTransactionToFeed(tx) {
            if (feed.children[0]?.textContent.includes("Waiting")) feed.innerHTML = '';

            const el = document.createElement('div');
            el.className = `new-item bg-gray-700/50 p-3 rounded-md text-sm font-mono ${tx.isWhale ? 'whale-alert' : ''}`;
            
            const fromShort = `${tx.from.substring(0, 6)}...${tx.from.substring(tx.from.length - 4)}`;
            const toShort = `${tx.to.substring(0, 6)}...${tx.to.substring(tx.to.length - 4)}`;

            el.innerHTML = `
                <div class="flex justify-between items-center">
                    <div>
                        <span>From: <span class="text-gray-400">${fromShort}</span></span>
                        <span class="mx-2">‚Üí</span>
                        <span>To: <span class="text-gray-400">${toShort}</span></span>
                    </div>
                    <div class="font-bold text-white">${formatValue(tx.value)}</div>
                </div>
            `;
            feed.prepend(el);
            if (feed.children.length > 100) feed.removeChild(feed.lastChild);
        }

        function addWhaleAlert(tx) {
            if (whaleFeed.children[0]?.textContent.includes("Waiting")) whaleFeed.innerHTML = '';
            
            const el = document.createElement('div');
            el.className = 'new-item bg-amber-900/30 border border-amber-700 p-3 rounded-md text-sm';
            
            const fromShort = `${tx.from.substring(0, 8)}...`;
            const toShort = `${tx.to.substring(0, 8)}...`;

            el.innerHTML = `
                <div class="font-bold text-amber-400 mb-1">üê≥ Whale Alert!</div>
                <div class="font-mono">
                    <p>From: <span class="text-gray-400">${fromShort}</span></p>
                    <p>To: <span class="text-gray-400">${toShort}</span></p>
                    <p>Value: <span class="font-bold text-white">${formatValue(tx.value)}</span></p>
                </div>
            `;
            whaleFeed.prepend(el);
            if (whaleFeed.children.length > 50) whaleFeed.removeChild(whaleFeed.lastChild);
        }

        function updateTokenInfo(tokenData) {
            const tokenInfo = document.getElementById('tokenInfo');
            const tokenName = document.getElementById('tokenName');
            const tokenTicker = document.getElementById('tokenTicker');
            const tokenLogo = document.getElementById('tokenLogo');
            const displayTokenAddress = document.getElementById('displayTokenAddress');

            // Show the token info section
            tokenInfo.classList.remove('hidden');

            // Update token name and ticker
            tokenName.textContent = tokenData.name || 'Unknown Token';
            tokenTicker.textContent = `$${tokenData.symbol || 'UNKNOWN'}`;

            // Update contract address (shortened)
            const address = tokenData.address || '';
            displayTokenAddress.textContent = address ? 
                `${address.substring(0, 8)}...${address.substring(address.length - 6)}` : 
                'Unknown';

            // Update logo if available
            if (tokenData.logoUrl) {
                tokenLogo.src = tokenData.logoUrl;
                tokenLogo.classList.remove('hidden');
            } else {
                tokenLogo.classList.add('hidden');
            }
        }

    </script>
</body>
</html>
